---
import { pathList } from '../../constants/pathList';
import { ASSETS_URL, SITE_URL } from '../../constants/siteData';
import { retrieveTranslation } from '../../locales/i18n';

const webSiteTitle = retrieveTranslation('website.title');
---

<link rel="alternate" type="application/atom+xml" href={`/${pathList.feed}`} title={webSiteTitle} />
<link rel="dns-prefetch" href={ASSETS_URL} />

<link rel="icon" type="image/png" href={`${ASSETS_URL}/favicon-96x96.png" sizes="96x96`} />
<link rel="icon" type="image/svg+xml" href={`${ASSETS_URL}/favicon.svg`} />
<link rel="shortcut icon" href={`${ASSETS_URL}/favicon.ico`} />
<link rel="apple-touch-icon" sizes="180x180" href={`${ASSETS_URL}/apple-touch-icon.png`} />
<link rel="manifest" href={`${SITE_URL}/site.webmanifest`} />

<script>
  import { parse } from 'valibot';

  import { initialDatalayer } from '../data/tracking/dataLayer';
  import { GTM_URL } from '../data/tracking/gtmData';
  import { optoutResponseSchema } from '../data/tracking/optoutApiValidationSchema';

  const res = await fetch('/api/optout', { method: 'GET' });
  const body = await res.json();
  const { enabled } = parse(optoutResponseSchema, body);

  if (!enabled) {
    const script = document.createElement('script');
    script.defer = true;
    script.src = GTM_URL;
    document.head.appendChild(script);

    initialDatalayer();
  }
</script>
